### Microsoft Cognitive Services - Face api integrated to Node-red

#### Using Node-red build Microsoft FaceAPI node

##### Create Node:
include Group create, Person name create, Person face create, you can upload picture via file, or from a url, even for-loop.

##### Train Node:
Trigger group training

##### Identify Node:
Identify Person from a trained group, you can upload picture via file, or from a url

##### Sample Flow:
```
[{"id":"c5fae134.790df","type":"inject","z":"e05826eb.adc6f8","name":"File inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":100,"wires":[["d3f28e9c.806e8"]]},{"id":"d3f28e9c.806e8","type":"file in","z":"e05826eb.adc6f8","name":"Image file","filename":"/Users/ika/Desktop/test.png","format":"","chunk":false,"sendError":true,"x":320,"y":100,"wires":[["c58d095c.5da828"]]},{"id":"a1338ec6.1dd99","type":"function","z":"e05826eb.adc6f8","name":"Image link","func":"msg.payload = 'https://storage.mantan-web.jp/images/2015/09/08/20150908dog00m200047000c/001_size8.jpg';\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":140,"wires":[["c58d095c.5da828"]]},{"id":"c6317c08.16729","type":"inject","z":"e05826eb.adc6f8","name":"URL inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":140,"wires":[["a1338ec6.1dd99"]]},{"id":"772ebc9e.29a7e4","type":"debug","z":"e05826eb.adc6f8","name":"","active":true,"console":"false","complete":"true","x":930,"y":220,"wires":[]},{"id":"9cf86224.f4217","type":"inject","z":"e05826eb.adc6f8","name":"Training inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":110,"y":700,"wires":[["cb3628a2.9c69f8"]]},{"id":"c53b994c.e67d28","type":"inject","z":"e05826eb.adc6f8","name":"File inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":700,"y":700,"wires":[["9e961afc.590428"]]},{"id":"9e961afc.590428","type":"file in","z":"e05826eb.adc6f8","name":"Image file","filename":"/Users/ika/Desktop/test.png","format":"","chunk":false,"sendError":true,"x":860,"y":700,"wires":[["86e786c2.552178"]]},{"id":"b14e4fd2.9fd4c","type":"function","z":"e05826eb.adc6f8","name":"Image link","func":"msg.payload = 'https://cdn2.ettoday.net/images/2304/d2304170.jpg';\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":780,"wires":[["86e786c2.552178"]]},{"id":"bc2992a8.abb4e","type":"inject","z":"e05826eb.adc6f8","name":"URL inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":700,"y":780,"wires":[["b14e4fd2.9fd4c"]]},{"id":"d93b7b14.0a2448","type":"debug","z":"e05826eb.adc6f8","name":"","active":true,"console":"false","complete":"true","x":1190,"y":740,"wires":[]},{"id":"59c84064.1e8b4","type":"debug","z":"e05826eb.adc6f8","name":"","active":true,"console":"false","complete":"true","x":450,"y":700,"wires":[]},{"id":"ead3d8cd.aac858","type":"comment","z":"e05826eb.adc6f8","name":"建立人物 & 上傳人臉照片","info":"","x":830,"y":160,"wires":[]},{"id":"65f58ff3.c09c7","type":"comment","z":"e05826eb.adc6f8","name":"觸發訓練 & 傳回訓練狀態","info":"","x":150,"y":640,"wires":[]},{"id":"2b38afa3.ef3c8","type":"comment","z":"e05826eb.adc6f8","name":"上傳照片 & 辨識 -> 傳回人物 id等資訊","info":"","x":790,"y":640,"wires":[]},{"id":"1f3d202b.cf77d","type":"comment","z":"e05826eb.adc6f8","name":"由 Pi 提供拍照及輸入資料的介面，直接拍照傳遞資料上傳至 face api","info":"","x":280,"y":260,"wires":[]},{"id":"61183c8c.fccf64","type":"faceapi-create","z":"e05826eb.adc6f8","name":"Create","broker":"8d24065c.b9d2b8","x":770,"y":220,"wires":[["772ebc9e.29a7e4"]]},{"id":"cb3628a2.9c69f8","type":"faceapi-train","z":"e05826eb.adc6f8","name":"Training","broker":"8d24065c.b9d2b8","x":300,"y":700,"wires":[["59c84064.1e8b4"]]},{"id":"86e786c2.552178","type":"faceapi-identify","z":"e05826eb.adc6f8","name":"Identify","broker":"8d24065c.b9d2b8","x":1040,"y":740,"wires":[["d93b7b14.0a2448"]]},{"id":"c58d095c.5da828","type":"function","z":"e05826eb.adc6f8","name":"person name","func":"msg.personName = 'Ichiro'; \nmsg.personInfo = 'Sakanaction';\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":120,"wires":[["61183c8c.fccf64"]]},{"id":"c024d9ca.dfc328","type":"http in","z":"e05826eb.adc6f8","name":"Pi inject","url":"/from-pi","method":"get","upload":false,"swaggerDoc":"","x":90,"y":220,"wires":[["61183c8c.fccf64"]]},{"id":"40ca89a.59ff378","type":"http in","z":"e05826eb.adc6f8","name":"Pi Training inject","url":"/from-pi-train","method":"get","upload":false,"swaggerDoc":"","x":120,"y":760,"wires":[["cb3628a2.9c69f8"]]},{"id":"e9f06467.979f08","type":"inject","z":"e05826eb.adc6f8","name":"Array inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":100,"y":460,"wires":[["36950436.5ca1bc"]]},{"id":"fdb74df9.f7d2e","type":"switch","z":"e05826eb.adc6f8","name":"i < n","property":"i","propertyType":"msg","rules":[{"t":"lt","v":"20","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":430,"y":460,"wires":[["d20902d4.54a3f"],["45f1673a.e4d2e8"]]},{"id":"e2d02588.d37608","type":"function","z":"e05826eb.adc6f8","name":"i++","func":"msg.i++;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":320,"wires":[["fdb74df9.f7d2e"]]},{"id":"c4be0dfd.6ccc1","type":"faceapi-create","z":"e05826eb.adc6f8","name":"Create","broker":"8d24065c.b9d2b8","x":770,"y":420,"wires":[["744f9cb4.97da24","5cd69dd5.8c0764"]]},{"id":"744f9cb4.97da24","type":"debug","z":"e05826eb.adc6f8","name":"","active":true,"console":"false","complete":"true","x":930,"y":460,"wires":[]},{"id":"decebfa1.3c623","type":"comment","z":"e05826eb.adc6f8","name":"也可使用迴圈大量上傳至face api","info":"","x":170,"y":520,"wires":[]},{"id":"13559233.e6f79e","type":"comment","z":"e05826eb.adc6f8","name":"由 Face api 提供的兩種方式上傳並建立資料庫","info":"","x":210,"y":60,"wires":[]},{"id":"d20902d4.54a3f","type":"function","z":"e05826eb.adc6f8","name":"image array","func":"msg.imageArray = [\n  {\n    \"name\": \"Masa\",\n    \"info\": \"Mayday Masa\",\n    \"url\": \"http://c1.staticflickr.com/1/886/42450048011_20bf740884_z.jpg\"\n  },\n  {\n    \"name\": \"Masa\",\n    \"info\": \"Mayday Masa\",\n    \"url\": \"http://c1.staticflickr.com/2/1722/28576761898_a0f66c76ec.jpg\"\n  },\n  {\n    \"name\": \"Masa\",\n    \"info\": \"Mayday Masa\",\n    \"url\": \"http://c1.staticflickr.com/1/877/42450048091_95bd29f50d.jpg\"\n  },\n  {\n    \"name\": \"Masa\",\n    \"info\": \"Mayday Masa\",\n    \"url\": \"http://c1.staticflickr.com/2/1739/42450048231_ca34a6bc29.jpg\"\n  },\n  {\n    \"name\": \"Monster\",\n    \"info\": \"Mayday Monster\",\n    \"url\": \"http://c1.staticflickr.com/1/885/42399427452_17b27ffa78.jpg\"\n  },\n  {\n    \"name\": \"Monster\",\n    \"info\": \"Mayday Monster\",\n    \"url\": \"http://c1.staticflickr.com/2/1744/28576761938_c1bec32450.jpg\"\n  },\n  {\n    \"name\": \"Monster\",\n    \"info\": \"Mayday Monster\",\n    \"url\": \"http://c1.staticflickr.com/2/1724/28576761958_d509a992b3_n.jpg\"\n  },\n  {\n    \"name\": \"Monster\",\n    \"info\": \"Mayday Monster\",\n    \"url\": \"http://c1.staticflickr.com/2/1742/28576762038_115bd7045a.jpg\"\n  },\n  {\n    \"name\": \"Stone\",\n    \"info\": \"Mayday Stone\",\n    \"url\": \"http://c1.staticflickr.com/2/1745/28576762088_8ee89e02ac.jpg\"\n  },\n  {\n    \"name\": \"Stone\",\n    \"info\": \"Mayday Stone\",\n    \"url\": \"http://c1.staticflickr.com/2/1752/28576762238_2aa5e39c00.jpg\"\n  },\n  {\n    \"name\": \"Stone\",\n    \"info\": \"Mayday Stone\",\n    \"url\": \"http://c1.staticflickr.com/1/878/28576762298_4264d2ee7b.jpg\"\n  },\n  {\n    \"name\": \"Stone\",\n    \"info\": \"Mayday Stone\",\n    \"url\": \"http://c1.staticflickr.com/1/890/41726627974_6ce397dcd5_z.jpg\"\n  },\n  {\n    \"name\": \"Guan-You\",\n    \"info\": \"Mayday Guan-You\",\n    \"url\": \"http://c1.staticflickr.com/2/1749/28576762318_f3d97096e5.jpg\"\n  },\n  {\n    \"name\": \"Guan-You\",\n    \"info\": \"Mayday Guan-You\",\n    \"url\": \"http://c1.staticflickr.com/1/902/41726627234_6034125158.jpg\"\n  },\n  {\n    \"name\": \"Guan-You\",\n    \"info\": \"Mayday Guan-You\",\n    \"url\": \"http://c1.staticflickr.com/2/1722/41726627314_a4dde7853e_n.jpg\"\n  },\n  {\n    \"name\": \"Ashin\",\n    \"info\": \"Mayday Ashin\",\n    \"url\": \"http://c1.staticflickr.com/2/1751/28576762348_c4349c6b77.jpg\"\n  },\n  {\n    \"name\": \"Ashin\",\n    \"info\": \"Mayday Ashin\",\n    \"url\": \"http://c1.staticflickr.com/2/1739/28576762378_2b8fb5f68c_z.jpg\"\n  },\n  {\n    \"name\": \"Ashin\",\n    \"info\": \"Mayday Ashin\",\n    \"url\": \"http://c1.staticflickr.com/1/881/28576762428_8712a7c247_m.jpg\"\n  },\n  {\n    \"name\": \"Ashin\",\n    \"info\": \"Mayday Ashin\",\n    \"url\": \"http://c1.staticflickr.com/1/877/28576762518_c7883ffe8a.jpg\"\n  },\n  {\n    \"name\": \"Ashin\",\n    \"info\": \"Mayday Ashin\",\n    \"url\": \"http://c1.staticflickr.com/2/1735/41726626884_5894c76a6a.jpg\"\n  }\n];\nvar i = msg.i;\nmsg.error = '';\nmsg.payload = msg.imageArray[i].url;\nmsg.personName = msg.imageArray[i].name;\nmsg.personInfo = msg.imageArray[i].info\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":420,"wires":[["c4be0dfd.6ccc1"]]},{"id":"a64d33c4.b3d7e","type":"debug","z":"e05826eb.adc6f8","name":"","active":true,"console":"false","complete":"true","x":770,"y":500,"wires":[]},{"id":"36950436.5ca1bc","type":"template","z":"e05826eb.adc6f8","name":"i = 0","field":"i","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"0","output":"str","x":270,"y":460,"wires":[["fdb74df9.f7d2e"]]},{"id":"45f1673a.e4d2e8","type":"function","z":"e05826eb.adc6f8","name":"end loop","func":"msg.payload = 'end loop';\ndelete msg.imageArray;\ndelete msg.personName;\ndelete msg.personInfo;\ndelete msg.i;\n\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":500,"wires":[["a64d33c4.b3d7e"]]},{"id":"5cd69dd5.8c0764","type":"delay","z":"e05826eb.adc6f8","name":"Delay 20 Sec","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":950,"y":380,"wires":[["e2d02588.d37608"]]},{"id":"b4fea764.28a6c8","type":"comment","z":"e05826eb.adc6f8","name":"免費版每分鐘 20 個操作，故延遲 20 秒","info":"","x":1030,"y":320,"wires":[]},{"id":"8d24065c.b9d2b8","type":"faceapi-broker","z":"","name":"group - mayday","subkey":"260f19e45ac94af0b5a1cb0003d96f1c","server":"westcentralus.api.cognitive.microsoft.com","groupid":"mayday","groupinfo":"mayday group"}]
```